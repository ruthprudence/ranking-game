{"ast":null,"code":"// uiSlice.js\nimport{createSlice,createAction}from'@reduxjs/toolkit';import{createItemsWithVotes}from'../matchup/createItemsWithVotes';import{initializeScores}from'../matchup/initializeScores';import{MAXCHOICES,MINCHOICES}from'../constants';import{pairingLogic}from'../matchup/pairingLogic';import{calculateRankings}from'../results/calculateRankings';import{calculateScores}from'../results/calculateScores';export const transitionToMatchup=createAction('ui/transitionToMatchup');export const uiSlice=createSlice({name:'ui',initialState:{topic:'',rows:['','',''],items:[],scores:{},pairs:[],currentPairIndex:0,isComparisonComplete:false,rankings:[]},reducers:{/** Splash Page */submitTopic:(state,action)=>{const topic=action.payload;if(!topic.trim()){alert('Please enter a topic.');return;}state.topic=topic;},setTopic:(state,action)=>{state.topic=action.payload;},/** Input Page */submitInputPage:state=>{state.items=createItemsWithVotes(state.rows);state.scores=initializeScores(state);},addItem:state=>{state.items.push('');},updateItem:(state,action)=>{const{index,value}=action.payload;state.items[index]=value;},removeItem:(state,action)=>{state.items.splice(action.payload,1);},setItems:(state,action)=>{state.items=action.payload;},addRow:state=>{if(state.rows.length<MAXCHOICES){state.rows.push('');}},removeRow:(state,action)=>{if(state.rows.length>MINCHOICES&&action.payload>=0&&action.payload<state.rows.length){state.rows.splice(action.payload,1);}},updateRow:(state,action)=>{const{index,updatedValue}=action.payload;if(index>=0&&index<state.rows.length){state.rows[index]=updatedValue;}},setValue:(state,action)=>{state.value=action.payload;},startMatchup:(state,action)=>{const items=action.payload;state.pairs=pairingLogic(items);state.currentPairIndex=0;state.isComparisonComplete=false;},selectChoice:(state,action)=>{const choiceName=action.payload;console.log(\"Selected choice name:\",choiceName);console.log(\"Current items before update:\",state.items);const updatedItems=state.items.map(item=>{if(item.name===choiceName){console.log(\"Updating votes for \".concat(choiceName));return{...item,votes:(item.votes||0)+1};}return item;});console.log(\"Updated items:\",updatedItems);state.items=updatedItems;},incrementVote:(state,action)=>{const selectedItem=action.payload;const itemIndex=state.items.findIndex(item=>item.id===selectedItem.id);if(itemIndex!==-1){state.items[itemIndex].votes+=1;}},nextPair:state=>{console.log(\"Current pair index before update:\",state.currentPairIndex);console.log(\"Pairs:\",state.pairs);state.currentPairIndex+=1;console.log(\"Updated current pair index:\",state.currentPairIndex);console.log(\"New Current Pair:\",state.pairs[state.currentPairIndex]);},handleChoiceSelect:(state,action)=>{const{choiceIndex,items}=action.payload;if(state.pairs.length>state.currentPairIndex){const currentPair=state.pairs[state.currentPairIndex];if(currentPair&&currentPair.length===2){const selectedItem=items[currentPair[choiceIndex]];if(selectedItem){// Directly update votes here\nconst itemIndex=state.items.findIndex(item=>item.id===selectedItem.id);if(itemIndex!==-1){state.items[itemIndex].votes+=1;// Increment votes\n}state.currentPairIndex+=1;}}}// Check if the comparison is complete\nif(state.currentPairIndex>=state.pairs.length){state.isComparisonComplete=true;}},completeMatchup:state=>{state.rankings=calculateRankings(state.items);}}});export const selectItems=state=>state.ui.items;export const{addItem,updateItem,removeItem,setItems,addRow,removeRow,updateRow,setValue,setTopic,submitInputPage,submitTopic,submitTopicAndAdvance,handleValidation,handleTopicSubmit,selectChoice,incrementVote,startMatchup,nextPair,handleChoiceSelect,completeMatchup}=uiSlice.actions;export default uiSlice.reducer;","map":{"version":3,"names":["createSlice","createAction","createItemsWithVotes","initializeScores","MAXCHOICES","MINCHOICES","pairingLogic","calculateRankings","calculateScores","transitionToMatchup","uiSlice","name","initialState","topic","rows","items","scores","pairs","currentPairIndex","isComparisonComplete","rankings","reducers","submitTopic","state","action","payload","trim","alert","setTopic","submitInputPage","addItem","push","updateItem","index","value","removeItem","splice","setItems","addRow","length","removeRow","updateRow","updatedValue","setValue","startMatchup","selectChoice","choiceName","console","log","updatedItems","map","item","concat","votes","incrementVote","selectedItem","itemIndex","findIndex","id","nextPair","handleChoiceSelect","choiceIndex","currentPair","completeMatchup","selectItems","ui","submitTopicAndAdvance","handleValidation","handleTopicSubmit","actions","reducer"],"sources":["/Users/ruth/Dropbox/Developer/apps/ps/rg/src/features/ui/uiSlice.js"],"sourcesContent":["// uiSlice.js\nimport { createSlice, createAction} from '@reduxjs/toolkit';\nimport { createItemsWithVotes } from '../matchup/createItemsWithVotes';\nimport { initializeScores } from '../matchup/initializeScores';\nimport { MAXCHOICES, MINCHOICES } from '../constants';\nimport { pairingLogic } from '../matchup/pairingLogic';\n\nimport { calculateRankings } from '../results/calculateRankings';\nimport { calculateScores } from '../results/calculateScores';\n\nexport const transitionToMatchup = createAction('ui/transitionToMatchup');\n\nexport const uiSlice = createSlice({\n  name: 'ui',\n  initialState: {\n    topic: '',\n    rows: ['', '', ''],\n    items: [],\n    scores: {},\n    pairs: [],\n    currentPairIndex: 0,\n    isComparisonComplete: false,\n    rankings: [],\n  },\n  reducers: {\n    /** Splash Page */\n    submitTopic: (state, action) => {\n      const topic = action.payload;\n      if (!topic.trim()) {\n          alert('Please enter a topic.');\n          return;\n      }\n      state.topic = topic;\n    },\n    setTopic: (state, action) => {\n      state.topic = action.payload;\n    },\n\n    /** Input Page */\n    submitInputPage: (state) => {\n          state.items = createItemsWithVotes(state.rows);\n          state.scores = initializeScores(state);\n    },  \n    addItem: (state) => {\n          state.items.push('');\n    },\n    updateItem: (state, action) => {\n          const { index, value } = action.payload;\n          state.items[index] = value;\n    },\n    removeItem: (state, action) => {\n        state.items.splice(action.payload, 1);\n    },\n    setItems: (state, action) => {\n        state.items = action.payload;\n    },\n    addRow: (state) => {\n        if (state.rows.length < MAXCHOICES) {\n          state.rows.push('');\n        }\n    },\n    removeRow: (state, action) => {\n        if (state.rows.length > MINCHOICES && action.payload >= 0 && action.payload < state.rows.length) {\n          state.rows.splice(action.payload, 1);\n        }\n    },\n    updateRow: (state, action) => {\n        const { index, updatedValue } = action.payload;\n        if (index >= 0 && index < state.rows.length) {\n            state.rows[index] = updatedValue;\n        }\n    },\n    setValue: (state, action) => {\n        state.value = action.payload;\n    },  \n    startMatchup: (state, action) => {\n      const items = action.payload;\n      state.pairs = pairingLogic(items);\n      state.currentPairIndex = 0;\n      state.isComparisonComplete = false;\n    },  \n    selectChoice: (state, action) => {\n      const choiceName = action.payload;\n      console.log(\"Selected choice name:\", choiceName);\n      console.log(\"Current items before update:\", state.items);\n    \n      const updatedItems = state.items.map(item => {\n        if (item.name === choiceName) {\n          console.log(`Updating votes for ${choiceName}`);\n          return { ...item, votes: (item.votes || 0) + 1 };\n        }\n        return item;\n      });\n    \n      console.log(\"Updated items:\", updatedItems);\n      state.items = updatedItems;\n    },\n    incrementVote: (state, action) => {\n      const selectedItem = action.payload;\n      const itemIndex = state.items.findIndex(item => item.id === selectedItem.id);\n      if (itemIndex !== -1) {\n        state.items[itemIndex].votes += 1;\n      }\n    },\n\n    nextPair: (state) => {\n      console.log(\"Current pair index before update:\", state.currentPairIndex);\n      console.log(\"Pairs:\", state.pairs);\n      state.currentPairIndex += 1;\n      console.log(\"Updated current pair index:\", state.currentPairIndex);\n      console.log(\"New Current Pair:\", state.pairs[state.currentPairIndex]);\n    },\n    handleChoiceSelect: (state, action) => {\n      const { choiceIndex, items } = action.payload;\n    \n      if (state.pairs.length > state.currentPairIndex) {\n        const currentPair = state.pairs[state.currentPairIndex];\n        if (currentPair && currentPair.length === 2) {\n          const selectedItem = items[currentPair[choiceIndex]];\n          \n          if (selectedItem) {\n            // Directly update votes here\n            const itemIndex = state.items.findIndex(item => item.id === selectedItem.id);\n            if (itemIndex !== -1) {\n              state.items[itemIndex].votes += 1; // Increment votes\n            }\n            state.currentPairIndex += 1;\n          }\n        }\n      }\n    \n      // Check if the comparison is complete\n      if (state.currentPairIndex >= state.pairs.length) {\n        state.isComparisonComplete = true;\n      }\n    },\n    completeMatchup: (state) => {\n      state.rankings = calculateRankings(state.items);\n    },\n    \n    \n  \n  },\n});\n\nexport const selectItems = (state) => state.ui.items;\n\nexport const { addItem, updateItem, removeItem, setItems, addRow, removeRow, updateRow, setValue, setTopic, submitInputPage, submitTopic, submitTopicAndAdvance, handleValidation, handleTopicSubmit, selectChoice, incrementVote, startMatchup, nextPair, handleChoiceSelect, completeMatchup } = uiSlice.actions;\n  \n  export default uiSlice.reducer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}