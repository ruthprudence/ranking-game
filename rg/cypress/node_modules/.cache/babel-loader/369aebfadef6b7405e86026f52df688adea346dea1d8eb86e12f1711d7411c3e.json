{"ast":null,"code":"// uiSlice.js\nimport { createSlice, createAction } from '@reduxjs/toolkit';\nimport { createItemsWithVotes } from '../matchup/createItemsWithVotes';\nimport { initializeScores } from '../matchup/initializeScores';\nimport { MAXCHOICES, MINCHOICES } from '../constants';\nimport { pairingLogic } from '../matchup/pairingLogic';\nimport { validateTopic } from '../actions';\nimport { calculateRankings } from '../results/calculateRankings';\nimport { calculateScores } from '../results/calculateScores';\nexport const transitionToMatchup = createAction('ui/transitionToMatchup');\nconst initialState = {\n  topic: '',\n  rows: ['', '', ''],\n  items: [],\n  scores: {},\n  pairs: [],\n  currentPairIndex: 0,\n  isComparisonComplete: false,\n  rankings: [],\n  isTopicValid: false\n};\nexport const uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    /** Splash Page */\n    submitTopic: (state, action) => {\n      const topic = action.payload;\n      if (!topic.trim()) {\n        alert('Please enter a topic.');\n        return;\n      }\n      state.topic = topic;\n    },\n    setTopic: (state, action) => {\n      state.topic = action.payload;\n    },\n    /** Input Page */\n    submitInputPage: state => {\n      state.items = createItemsWithVotes(state.rows);\n      state.scores = initializeScores(state);\n    },\n    addItem: state => {\n      state.items.push('');\n    },\n    updateItem: (state, action) => {\n      const {\n        index,\n        value\n      } = action.payload;\n      state.items[index] = value;\n    },\n    removeItem: (state, action) => {\n      state.items.splice(action.payload, 1);\n    },\n    setItems: (state, action) => {\n      state.items = action.payload;\n    },\n    addRow: state => {\n      if (state.rows.length < MAXCHOICES) {\n        state.rows.push('');\n      }\n    },\n    removeRow: (state, action) => {\n      if (state.rows.length > MINCHOICES && action.payload >= 0 && action.payload < state.rows.length) {\n        state.rows.splice(action.payload, 1);\n      }\n    },\n    updateRow: (state, action) => {\n      const {\n        index,\n        updatedValue\n      } = action.payload;\n      if (index >= 0 && index < state.rows.length) {\n        state.rows[index] = updatedValue;\n      }\n    },\n    setValue: (state, action) => {\n      state.value = action.payload;\n    },\n    startMatchup: (state, action) => {\n      const items = action.payload;\n      state.pairs = pairingLogic(items);\n      state.currentPairIndex = 0;\n      state.isComparisonComplete = false;\n    },\n    selectChoice: (state, action) => {\n      const choiceName = action.payload;\n      const updatedItems = state.items.map(item => {\n        if (item.name === choiceName) {\n          return {\n            ...item,\n            votes: (item.votes || 0) + 1\n          };\n        }\n        return item;\n      });\n      state.items = updatedItems;\n    },\n    incrementVote: (state, action) => {\n      const selectedItem = action.payload;\n      const itemIndex = state.items.findIndex(item => item.id === selectedItem.id);\n      if (itemIndex !== -1) {\n        state.items[itemIndex].votes += 1;\n      }\n    },\n    nextPair: state => {\n      state.currentPairIndex += 1;\n    },\n    handleChoiceSelect: (state, action) => {\n      const {\n        choiceIndex,\n        items\n      } = action.payload;\n      if (state.pairs.length > state.currentPairIndex) {\n        const currentPair = state.pairs[state.currentPairIndex];\n        if (currentPair && currentPair.length === 2) {\n          const selectedItem = items[currentPair[choiceIndex]];\n          if (selectedItem) {\n            // Directly update votes here\n            const itemIndex = state.items.findIndex(item => item.id === selectedItem.id);\n            if (itemIndex !== -1) {\n              state.items[itemIndex].votes += 1; // Increment votes\n            }\n            state.currentPairIndex += 1;\n          }\n        }\n      }\n\n      // Check if the comparison is complete\n      if (state.currentPairIndex >= state.pairs.length) {\n        state.isComparisonComplete = true;\n      }\n    },\n    completeMatchup: state => {\n      state.rankings = calculateRankings(state.items);\n    },\n    resetState: () => initialState\n  },\n  extraReducers: builder => {\n    builder.addCase(validateTopic.fulfilled, (state, action) => {\n      state.isTopicValid = action.payload.isTopicValid;\n      if (state.isTopicValid) {\n        state.topic = action.payload.topic;\n      }\n      // Handle other aspects of the validation result as needed\n    });\n    // Handle other async actions as needed\n  }\n});\nexport const {\n  resetState\n} = uiSlice.actions;\nexport const selectItems = state => state.ui.items;\nexport const {\n  addItem,\n  updateItem,\n  removeItem,\n  setItems,\n  addRow,\n  removeRow,\n  updateRow,\n  setValue,\n  setTopic,\n  submitInputPage,\n  submitTopic,\n  handleValidation,\n  handleTopicSubmit,\n  selectChoice,\n  incrementVote,\n  startMatchup,\n  nextPair,\n  handleChoiceSelect,\n  completeMatchup\n} = uiSlice.actions;\nexport default uiSlice.reducer;","map":{"version":3,"names":["createSlice","createAction","createItemsWithVotes","initializeScores","MAXCHOICES","MINCHOICES","pairingLogic","validateTopic","calculateRankings","calculateScores","transitionToMatchup","initialState","topic","rows","items","scores","pairs","currentPairIndex","isComparisonComplete","rankings","isTopicValid","uiSlice","name","reducers","submitTopic","state","action","payload","trim","alert","setTopic","submitInputPage","addItem","push","updateItem","index","value","removeItem","splice","setItems","addRow","length","removeRow","updateRow","updatedValue","setValue","startMatchup","selectChoice","choiceName","updatedItems","map","item","votes","incrementVote","selectedItem","itemIndex","findIndex","id","nextPair","handleChoiceSelect","choiceIndex","currentPair","completeMatchup","resetState","extraReducers","builder","addCase","fulfilled","actions","selectItems","ui","handleValidation","handleTopicSubmit","reducer"],"sources":["/Users/ruth/Dropbox/Developer/apps/ps/rg/src/features/ui/uiSlice.js"],"sourcesContent":["// uiSlice.js\nimport { createSlice, createAction} from '@reduxjs/toolkit';\nimport { createItemsWithVotes } from '../matchup/createItemsWithVotes';\nimport { initializeScores } from '../matchup/initializeScores';\nimport { MAXCHOICES, MINCHOICES } from '../constants';\nimport { pairingLogic } from '../matchup/pairingLogic';\nimport { validateTopic } from '../actions';\n\nimport { calculateRankings } from '../results/calculateRankings';\nimport { calculateScores } from '../results/calculateScores';\n\nexport const transitionToMatchup = createAction('ui/transitionToMatchup');\n\nconst initialState = {\n  topic: '',\n  rows: ['', '', ''],\n  items: [],\n  scores: {},\n  pairs: [],\n  currentPairIndex: 0,\n  isComparisonComplete: false,\n  rankings: [],\n  isTopicValid: false,\n};\n\nexport const uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    /** Splash Page */\n    submitTopic: (state, action) => {\n      const topic = action.payload;\n      if (!topic.trim()) {\n          alert('Please enter a topic.');\n          return;\n      }\n      state.topic = topic;\n    },\n    setTopic: (state, action) => {\n      state.topic = action.payload;\n    },\n\n    /** Input Page */\n    submitInputPage: (state) => {\n          state.items = createItemsWithVotes(state.rows);\n          state.scores = initializeScores(state);\n    },  \n    addItem: (state) => {\n          state.items.push('');\n    },\n    updateItem: (state, action) => {\n          const { index, value } = action.payload;\n          state.items[index] = value;\n    },\n    removeItem: (state, action) => {\n        state.items.splice(action.payload, 1);\n    },\n    setItems: (state, action) => {\n        state.items = action.payload;\n    },\n    addRow: (state) => {\n        if (state.rows.length < MAXCHOICES) {\n          state.rows.push('');\n        }\n    },\n    removeRow: (state, action) => {\n        if (state.rows.length > MINCHOICES && action.payload >= 0 && action.payload < state.rows.length) {\n          state.rows.splice(action.payload, 1);\n        }\n    },\n    updateRow: (state, action) => {\n        const { index, updatedValue } = action.payload;\n        if (index >= 0 && index < state.rows.length) {\n            state.rows[index] = updatedValue;\n        }\n    },\n    setValue: (state, action) => {\n        state.value = action.payload;\n    },  \n    startMatchup: (state, action) => {\n      const items = action.payload;\n      state.pairs = pairingLogic(items);\n      state.currentPairIndex = 0;\n      state.isComparisonComplete = false;\n    },  \n    selectChoice: (state, action) => {\n      const choiceName = action.payload;\n    \n      const updatedItems = state.items.map(item => {\n        if (item.name === choiceName) {\n          return { ...item, votes: (item.votes || 0) + 1 };\n        }\n        return item;\n      });\n    \n      state.items = updatedItems;\n    },\n    incrementVote: (state, action) => {\n      const selectedItem = action.payload;\n      const itemIndex = state.items.findIndex(item => item.id === selectedItem.id);\n      if (itemIndex !== -1) {\n        state.items[itemIndex].votes += 1;\n      }\n    },\n\n    nextPair: (state) => {\n      state.currentPairIndex += 1;\n    },\n    handleChoiceSelect: (state, action) => {\n      const { choiceIndex, items } = action.payload;\n    \n      if (state.pairs.length > state.currentPairIndex) {\n        const currentPair = state.pairs[state.currentPairIndex];\n        if (currentPair && currentPair.length === 2) {\n          const selectedItem = items[currentPair[choiceIndex]];\n          \n          if (selectedItem) {\n            // Directly update votes here\n            const itemIndex = state.items.findIndex(item => item.id === selectedItem.id);\n            if (itemIndex !== -1) {\n              state.items[itemIndex].votes += 1; // Increment votes\n            }\n            state.currentPairIndex += 1;\n          }\n        }\n      }\n    \n      // Check if the comparison is complete\n      if (state.currentPairIndex >= state.pairs.length) {\n        state.isComparisonComplete = true;\n      }\n    },\n    completeMatchup: (state) => {\n      state.rankings = calculateRankings(state.items);\n    },\n    resetState: () => initialState,\n    \n    \n    \n  \n  },\n  extraReducers: (builder) => {\n    builder.addCase(validateTopic.fulfilled, (state, action) => {\n      state.isTopicValid = action.payload.isTopicValid;\n      if (state.isTopicValid) {\n        state.topic = action.payload.topic;\n      }\n      // Handle other aspects of the validation result as needed\n    });\n    // Handle other async actions as needed\n  },\n});\n\nexport const { resetState } = uiSlice.actions;\n\nexport const selectItems = (state) => state.ui.items;\n\nexport const { addItem, updateItem, removeItem, setItems, addRow, removeRow, updateRow, setValue, setTopic, submitInputPage, submitTopic, handleValidation, handleTopicSubmit, selectChoice, incrementVote, startMatchup, nextPair, handleChoiceSelect, completeMatchup } = uiSlice.actions;\n  \n  export default uiSlice.reducer;"],"mappings":"AAAA;AACA,SAASA,WAAW,EAAEC,YAAY,QAAO,kBAAkB;AAC3D,SAASC,oBAAoB,QAAQ,iCAAiC;AACtE,SAASC,gBAAgB,QAAQ,6BAA6B;AAC9D,SAASC,UAAU,EAAEC,UAAU,QAAQ,cAAc;AACrD,SAASC,YAAY,QAAQ,yBAAyB;AACtD,SAASC,aAAa,QAAQ,YAAY;AAE1C,SAASC,iBAAiB,QAAQ,8BAA8B;AAChE,SAASC,eAAe,QAAQ,4BAA4B;AAE5D,OAAO,MAAMC,mBAAmB,GAAGT,YAAY,CAAC,wBAAwB,CAAC;AAEzE,MAAMU,YAAY,GAAG;EACnBC,KAAK,EAAE,EAAE;EACTC,IAAI,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;EAClBC,KAAK,EAAE,EAAE;EACTC,MAAM,EAAE,CAAC,CAAC;EACVC,KAAK,EAAE,EAAE;EACTC,gBAAgB,EAAE,CAAC;EACnBC,oBAAoB,EAAE,KAAK;EAC3BC,QAAQ,EAAE,EAAE;EACZC,YAAY,EAAE;AAChB,CAAC;AAED,OAAO,MAAMC,OAAO,GAAGrB,WAAW,CAAC;EACjCsB,IAAI,EAAE,IAAI;EACVX,YAAY;EACZY,QAAQ,EAAE;IACR;IACAC,WAAW,EAAEA,CAACC,KAAK,EAAEC,MAAM,KAAK;MAC9B,MAAMd,KAAK,GAAGc,MAAM,CAACC,OAAO;MAC5B,IAAI,CAACf,KAAK,CAACgB,IAAI,CAAC,CAAC,EAAE;QACfC,KAAK,CAAC,uBAAuB,CAAC;QAC9B;MACJ;MACAJ,KAAK,CAACb,KAAK,GAAGA,KAAK;IACrB,CAAC;IACDkB,QAAQ,EAAEA,CAACL,KAAK,EAAEC,MAAM,KAAK;MAC3BD,KAAK,CAACb,KAAK,GAAGc,MAAM,CAACC,OAAO;IAC9B,CAAC;IAED;IACAI,eAAe,EAAGN,KAAK,IAAK;MACtBA,KAAK,CAACX,KAAK,GAAGZ,oBAAoB,CAACuB,KAAK,CAACZ,IAAI,CAAC;MAC9CY,KAAK,CAACV,MAAM,GAAGZ,gBAAgB,CAACsB,KAAK,CAAC;IAC5C,CAAC;IACDO,OAAO,EAAGP,KAAK,IAAK;MACdA,KAAK,CAACX,KAAK,CAACmB,IAAI,CAAC,EAAE,CAAC;IAC1B,CAAC;IACDC,UAAU,EAAEA,CAACT,KAAK,EAAEC,MAAM,KAAK;MACzB,MAAM;QAAES,KAAK;QAAEC;MAAM,CAAC,GAAGV,MAAM,CAACC,OAAO;MACvCF,KAAK,CAACX,KAAK,CAACqB,KAAK,CAAC,GAAGC,KAAK;IAChC,CAAC;IACDC,UAAU,EAAEA,CAACZ,KAAK,EAAEC,MAAM,KAAK;MAC3BD,KAAK,CAACX,KAAK,CAACwB,MAAM,CAACZ,MAAM,CAACC,OAAO,EAAE,CAAC,CAAC;IACzC,CAAC;IACDY,QAAQ,EAAEA,CAACd,KAAK,EAAEC,MAAM,KAAK;MACzBD,KAAK,CAACX,KAAK,GAAGY,MAAM,CAACC,OAAO;IAChC,CAAC;IACDa,MAAM,EAAGf,KAAK,IAAK;MACf,IAAIA,KAAK,CAACZ,IAAI,CAAC4B,MAAM,GAAGrC,UAAU,EAAE;QAClCqB,KAAK,CAACZ,IAAI,CAACoB,IAAI,CAAC,EAAE,CAAC;MACrB;IACJ,CAAC;IACDS,SAAS,EAAEA,CAACjB,KAAK,EAAEC,MAAM,KAAK;MAC1B,IAAID,KAAK,CAACZ,IAAI,CAAC4B,MAAM,GAAGpC,UAAU,IAAIqB,MAAM,CAACC,OAAO,IAAI,CAAC,IAAID,MAAM,CAACC,OAAO,GAAGF,KAAK,CAACZ,IAAI,CAAC4B,MAAM,EAAE;QAC/FhB,KAAK,CAACZ,IAAI,CAACyB,MAAM,CAACZ,MAAM,CAACC,OAAO,EAAE,CAAC,CAAC;MACtC;IACJ,CAAC;IACDgB,SAAS,EAAEA,CAAClB,KAAK,EAAEC,MAAM,KAAK;MAC1B,MAAM;QAAES,KAAK;QAAES;MAAa,CAAC,GAAGlB,MAAM,CAACC,OAAO;MAC9C,IAAIQ,KAAK,IAAI,CAAC,IAAIA,KAAK,GAAGV,KAAK,CAACZ,IAAI,CAAC4B,MAAM,EAAE;QACzChB,KAAK,CAACZ,IAAI,CAACsB,KAAK,CAAC,GAAGS,YAAY;MACpC;IACJ,CAAC;IACDC,QAAQ,EAAEA,CAACpB,KAAK,EAAEC,MAAM,KAAK;MACzBD,KAAK,CAACW,KAAK,GAAGV,MAAM,CAACC,OAAO;IAChC,CAAC;IACDmB,YAAY,EAAEA,CAACrB,KAAK,EAAEC,MAAM,KAAK;MAC/B,MAAMZ,KAAK,GAAGY,MAAM,CAACC,OAAO;MAC5BF,KAAK,CAACT,KAAK,GAAGV,YAAY,CAACQ,KAAK,CAAC;MACjCW,KAAK,CAACR,gBAAgB,GAAG,CAAC;MAC1BQ,KAAK,CAACP,oBAAoB,GAAG,KAAK;IACpC,CAAC;IACD6B,YAAY,EAAEA,CAACtB,KAAK,EAAEC,MAAM,KAAK;MAC/B,MAAMsB,UAAU,GAAGtB,MAAM,CAACC,OAAO;MAEjC,MAAMsB,YAAY,GAAGxB,KAAK,CAACX,KAAK,CAACoC,GAAG,CAACC,IAAI,IAAI;QAC3C,IAAIA,IAAI,CAAC7B,IAAI,KAAK0B,UAAU,EAAE;UAC5B,OAAO;YAAE,GAAGG,IAAI;YAAEC,KAAK,EAAE,CAACD,IAAI,CAACC,KAAK,IAAI,CAAC,IAAI;UAAE,CAAC;QAClD;QACA,OAAOD,IAAI;MACb,CAAC,CAAC;MAEF1B,KAAK,CAACX,KAAK,GAAGmC,YAAY;IAC5B,CAAC;IACDI,aAAa,EAAEA,CAAC5B,KAAK,EAAEC,MAAM,KAAK;MAChC,MAAM4B,YAAY,GAAG5B,MAAM,CAACC,OAAO;MACnC,MAAM4B,SAAS,GAAG9B,KAAK,CAACX,KAAK,CAAC0C,SAAS,CAACL,IAAI,IAAIA,IAAI,CAACM,EAAE,KAAKH,YAAY,CAACG,EAAE,CAAC;MAC5E,IAAIF,SAAS,KAAK,CAAC,CAAC,EAAE;QACpB9B,KAAK,CAACX,KAAK,CAACyC,SAAS,CAAC,CAACH,KAAK,IAAI,CAAC;MACnC;IACF,CAAC;IAEDM,QAAQ,EAAGjC,KAAK,IAAK;MACnBA,KAAK,CAACR,gBAAgB,IAAI,CAAC;IAC7B,CAAC;IACD0C,kBAAkB,EAAEA,CAAClC,KAAK,EAAEC,MAAM,KAAK;MACrC,MAAM;QAAEkC,WAAW;QAAE9C;MAAM,CAAC,GAAGY,MAAM,CAACC,OAAO;MAE7C,IAAIF,KAAK,CAACT,KAAK,CAACyB,MAAM,GAAGhB,KAAK,CAACR,gBAAgB,EAAE;QAC/C,MAAM4C,WAAW,GAAGpC,KAAK,CAACT,KAAK,CAACS,KAAK,CAACR,gBAAgB,CAAC;QACvD,IAAI4C,WAAW,IAAIA,WAAW,CAACpB,MAAM,KAAK,CAAC,EAAE;UAC3C,MAAMa,YAAY,GAAGxC,KAAK,CAAC+C,WAAW,CAACD,WAAW,CAAC,CAAC;UAEpD,IAAIN,YAAY,EAAE;YAChB;YACA,MAAMC,SAAS,GAAG9B,KAAK,CAACX,KAAK,CAAC0C,SAAS,CAACL,IAAI,IAAIA,IAAI,CAACM,EAAE,KAAKH,YAAY,CAACG,EAAE,CAAC;YAC5E,IAAIF,SAAS,KAAK,CAAC,CAAC,EAAE;cACpB9B,KAAK,CAACX,KAAK,CAACyC,SAAS,CAAC,CAACH,KAAK,IAAI,CAAC,CAAC,CAAC;YACrC;YACA3B,KAAK,CAACR,gBAAgB,IAAI,CAAC;UAC7B;QACF;MACF;;MAEA;MACA,IAAIQ,KAAK,CAACR,gBAAgB,IAAIQ,KAAK,CAACT,KAAK,CAACyB,MAAM,EAAE;QAChDhB,KAAK,CAACP,oBAAoB,GAAG,IAAI;MACnC;IACF,CAAC;IACD4C,eAAe,EAAGrC,KAAK,IAAK;MAC1BA,KAAK,CAACN,QAAQ,GAAGX,iBAAiB,CAACiB,KAAK,CAACX,KAAK,CAAC;IACjD,CAAC;IACDiD,UAAU,EAAEA,CAAA,KAAMpD;EAKpB,CAAC;EACDqD,aAAa,EAAGC,OAAO,IAAK;IAC1BA,OAAO,CAACC,OAAO,CAAC3D,aAAa,CAAC4D,SAAS,EAAE,CAAC1C,KAAK,EAAEC,MAAM,KAAK;MAC1DD,KAAK,CAACL,YAAY,GAAGM,MAAM,CAACC,OAAO,CAACP,YAAY;MAChD,IAAIK,KAAK,CAACL,YAAY,EAAE;QACtBK,KAAK,CAACb,KAAK,GAAGc,MAAM,CAACC,OAAO,CAACf,KAAK;MACpC;MACA;IACF,CAAC,CAAC;IACF;EACF;AACF,CAAC,CAAC;AAEF,OAAO,MAAM;EAAEmD;AAAW,CAAC,GAAG1C,OAAO,CAAC+C,OAAO;AAE7C,OAAO,MAAMC,WAAW,GAAI5C,KAAK,IAAKA,KAAK,CAAC6C,EAAE,CAACxD,KAAK;AAEpD,OAAO,MAAM;EAAEkB,OAAO;EAAEE,UAAU;EAAEG,UAAU;EAAEE,QAAQ;EAAEC,MAAM;EAAEE,SAAS;EAAEC,SAAS;EAAEE,QAAQ;EAAEf,QAAQ;EAAEC,eAAe;EAAEP,WAAW;EAAE+C,gBAAgB;EAAEC,iBAAiB;EAAEzB,YAAY;EAAEM,aAAa;EAAEP,YAAY;EAAEY,QAAQ;EAAEC,kBAAkB;EAAEG;AAAgB,CAAC,GAAGzC,OAAO,CAAC+C,OAAO;AAEzR,eAAe/C,OAAO,CAACoD,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}